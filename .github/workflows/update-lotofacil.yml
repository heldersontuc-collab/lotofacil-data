- name: Commit e push se houver mudanças (anti fetch-first)
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          # 1) sempre sincroniza antes de mexer
          git pull --rebase origin main

          # 2) agora adiciona e decide se tem mudança
          git add data/lotofacil.csv

          if git diff --cached --quiet; then
            echo "Sem mudanças no CSV."
            exit 0
          fi

          # 3) commita em cima do main atualizado
          git commit -m "Atualizar lotofacil.csv automaticamente"

          # 4) push com retry (se outro job correr junto)
          for i in 1 2 3 4 5; do
            echo "Tentativa $i de push..."
            if git push origin main; then
              echo "✅ Push OK"
              exit 0
            fi
            echo "Push falhou, rebasing e tentando de novo..."
            git pull --rebase origin main
            sleep 3
          done

          echo "❌ Falhou após várias tentativas"
          exit 1
